<!DOCTYPE html>
<html>
<head>
    <title>Logout Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .info { background: #e8f4f8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .step { margin: 10px 0; padding: 10px; background: white; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>🔄 Logout Loop Fix Test</h1>
    
    <div class="info">
        <strong>Testing the logout loop fix:</strong><br>
        This page helps verify that the logout process works correctly without infinite loops.
    </div>

    <div class="test-section">
        <h2>📋 Test Steps:</h2>
        <div class="step">1. <strong>Login</strong> - Go to login page and authenticate</div>
        <div class="step">2. <strong>Access Dashboard</strong> - Verify dashboard loads correctly</div>
        <div class="step">3. <strong>Logout</strong> - Click logout button in dashboard</div>
        <div class="step">4. <strong>Verify Redirect</strong> - Should redirect to login page cleanly</div>
        <div class="step">5. <strong>No Loop</strong> - Should NOT get stuck in redirect loops</div>
    </div>

    <div class="test-section">
        <h2>🔧 Quick Actions:</h2>
        <button onclick="clearAllData()">🗑️ Clear All Data</button>
        <button onclick="checkAuthState()">🔍 Check Auth State</button>
        <button onclick="testLogin()">🔐 Go to Login</button>
        <button onclick="testDashboard()">📊 Go to Dashboard</button>
    </div>

    <div class="test-section" id="output">
        <h2>📊 Test Output:</h2>
        <div id="results"></div>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">[${timestamp}] ${message}</div>`;
        }

        function clearAllData() {
            localStorage.clear();
            sessionStorage.clear();
            log('✅ Cleared all localStorage and sessionStorage data');
        }

        function checkAuthState() {
            const authToken = localStorage.getItem('authToken');
            const currentUser = localStorage.getItem('currentUser');
            const justLoggedOut = localStorage.getItem('justLoggedOut');
            
            log(`🔑 Auth Token: ${authToken ? 'Present' : 'None'}`);
            log(`👤 Current User: ${currentUser ? 'Present' : 'None'}`);
            log(`🚪 Just Logged Out Flag: ${justLoggedOut || 'None'}`);
            
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    log(`📋 User Details: ${user.username} (${user.role}) - Password Change: ${user.requirePasswordChange}`);
                } catch (e) {
                    log('❌ Invalid user data in localStorage');
                }
            }
        }

        function testLogin() {
            log('🔄 Redirecting to login page...');
            window.location.href = '/login.html';
        }

        function testDashboard() {
            log('🔄 Redirecting to dashboard...');
            window.location.href = '/dashboard';
        }

        // Auto-check auth state on load
        window.addEventListener('load', () => {
            log('🚀 Logout test page loaded');
            checkAuthState();
        });
    </script>
</body>
</html>
