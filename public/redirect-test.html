<!DOCTYPE html>
<html>
<head>
    <title>Redirect Test</title>
</head>
<body>
    <h1>Testing Password Change Redirect</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += `<p>[${new Date().toLocaleTimeString()}] ${message}</p>`;
            console.log(message);
        }
        
        log('🚀 Starting redirect test...');
        
        // Test the authentication endpoint
        fetch('/api/auth/me', {
            method: 'GET',
            credentials: 'include'
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error(`HTTP ${response.status}`);
        })
        .then(user => {
            log(`✅ User: ${user.username}`);
            log(`🔑 Password change required: ${user.requirePasswordChange}`);
            
            if (user.requirePasswordChange) {
                log('🚨 Password change required - should redirect!');
                log('⏳ Redirecting in 2 seconds...');
                
                setTimeout(() => {
                    log('🔄 Redirecting now...');
                    window.location.replace('/change-password?test=true');
                }, 2000);
            } else {
                log('✅ No password change required');
            }
        })
        .catch(error => {
            log(`❌ Error: ${error.message}`);
            log('💡 Try logging in first');
        });
    </script>
</body>
</html>
